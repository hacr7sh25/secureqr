<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Scan Logs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #181a20;
      color: #e4e6eb;
      padding: 20px;
    }
    h2 {
      color: #f5f6fa;
    }
    input[type="text"] {
      width: 300px;
      padding: 8px;
      margin-bottom: 15px;
      background: #23272f;
      color: #e4e6eb;
      border: 1px solid #444950;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #23272f;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    th, td {
      border: 1px solid #444950;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #343a40;
      color: #f5f6fa;
    }
    tr:nth-child(even) {
      background: #20232a;
    }
    tr:nth-child(odd) {
      background: #23272f;
    }
    #logoutBtn, #downloadBtn {
      margin-top: 10px;
      padding: 10px 15px;
      background-color: #007bff;
      color: #f5f6fa;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    #logoutBtn {
      background-color: #dc3545;
    }
    #logoutBtn:hover {
      background-color: #b52a37;
    }
    #downloadBtn:hover {
      background-color: #0056b3;
    }
    ::placeholder {
      color: #b0b3b8;
    }
  </style>
</head>
<body>
  <h2>üîê Admin Panel ‚Äì QR Scan Logs</h2>

  <input type="text" id="searchInput" placeholder="Search by UID, Status, Device, Location" onkeyup="filterTable()" />

  <button onclick="downloadCSV()" id="downloadBtn">‚¨áÔ∏è Download CSV</button>
  <button onclick="logout()" id="logoutBtn">üö™ Logout</button>

  <table id="logsTable">
    <thead>
      <tr>
        <th>UID</th>
        <th>Status</th>
        <th>Message</th>
        <th>Device ID</th>
        <th>Location</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="logBody">
      <!-- Logs will be injected here -->
    </tbody>
  </table>

  <script>
    async function fetchLogs() {
      const res = await fetch('/scan_logs');
      const data = await res.json();

      const body = document.getElementById('logBody');
      body.innerHTML = '';
      data.reverse().forEach(log => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${log.uid}</td>
          <td>${log.status}</td>
          <td>${log.message}</td>
          <td>${log.device_id}</td>
          <td>${log.location}</td>
          <td>${new Date(log.timestamp).toLocaleString()}</td>
        `;
        body.appendChild(row);
      });
    }

    function filterTable() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.getElementById('logBody').getElementsByTagName('tr');

      for (let row of rows) {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(input) ? '' : 'none';
      }
    }

    function logout() {
      fetch('/logout', { method: 'POST' }).then(() => location.href = '/login');
    }

    function downloadCSV() {
      window.location.href = '/download_csv';
    }

    fetchLogs();
  </script>
</body>
</html>
